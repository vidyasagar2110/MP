def simplex_solver(request):
    if request.method == "POST":
        if "num_vars" in request.POST:
            # Step 2: Render form for coefficients and constraints
            num_vars = int(request.POST.get("num_vars"))
            num_constraints = int(request.POST.get("num_constraints"))
            optimization = request.POST.get("optimization")

            return render(request, "simplex_form.html", {
                "num_vars": num_vars,
                "num_constraints": num_constraints,
                "optimization": optimization,
            })
        else:
            # Step 3: Solve the problem
            num_vars = int(request.POST.get("num_vars"))
            num_constraints = int(request.POST.get("num_constraints"))
            optimization = request.POST.get("optimization")

            c = [float(request.POST.get(f"c{i+1}")) for i in range(num_vars)]
            A = [[float(request.POST.get(f"a{i+1}_{j+1}")) for j in range(num_vars)] for i in range(num_constraints)]
            b = [float(request.POST.get(f"b{i+1}")) for i in range(num_constraints)]

            c = np.array(c)
            A = np.array(A)
            b = np.array(b)

            if optimization == "minimize":
                c = -c

            solution, optimal_value = simplex(c, A, b)

            if optimization == "minimize":
                optimal_value = -optimal_value

            return render(request, "simplex_result.html", {
                "solution": solution,
                "optimal_value": optimal_value,
            })

    return render(request, "simplex_initial.html")
